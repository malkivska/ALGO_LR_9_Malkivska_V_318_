#include "text_processing.h"  // Підключення заголовочного файлу з оголошеннями функцій
#include <fstream>            // Для роботи з файловими потоками
#include <iostream>           // Для вводу/виводу
#include <cctype>             // Для функцій перевірки символів (isalpha, isdigit)

using namespace std;          // Використання стандартного простору імен

// Функція підрахунку кількості слів у рядку
int count_words(const string& str) {
    int count = 0;            // Лічильник слів
    bool in_word = false;     // Прапорець: чи перебуваємо ми всередині слова

    // Перебираємо кожен символ у рядку
    for (char ch : str) {
        if (ch != ' ') {      // Якщо символ не пробіл
            if (!in_word) {   // Якщо раніше не були всередині слова
                in_word = true; // Позначаємо, що почалося слово
                count++;         // Збільшуємо лічильник слів
            }
        } else {
            in_word = false;   // Якщо символ пробіл — слово закінчилося
        }
    }
    return count;             // Повертаємо кількість слів
}

// Функція перевірки, чи рядок містить лише допустимі символи
bool is_valid(const string& str) {
    // Перебираємо кожен символ рядка
    for (char ch : str) {
        // Якщо символ не є літерою, цифрою, пробілом або підкресленням
        if (!(isalpha((unsigned char)ch) || isdigit((unsigned char)ch) || ch == ' ' || ch == '_'))
            return false;    // Повертаємо false — рядок недопустимий
    }
    return true;              // Якщо всі символи допустимі — повертаємо true
}

// Функція створення порожнього файлу sample.txt
void create_sample_file() {
    ofstream file("sample.txt");  // Відкриваємо файл для запису
    if (!file) {                  // Перевіряємо, чи файл відкрився успішно
        cerr << "Не вдалося відкрити файл для запису!" << endl; // Виводимо повідомлення про помилку
        return;                   // Вихід з функції
    }
    // Не записуємо нічого — файл буде порожнім
    file.close();                 // Закриваємо файл
}

// Функція обробки файлу sample.txt
// Читає рядки, перевіряє їх, рахує слова і записує результат в output.txt
void process_file() {
    ifstream file("sample.txt");  // Відкриваємо файл для читання
    if (!file) {                  // Якщо не вдалося відкрити файл
        cerr << "Не вдалося відкрити файл для читання!" << endl;  // Повідомляємо про помилку
        return;                   // Вихід з функції
    }

    ofstream out("output.txt");   // Відкриваємо файл для запису результатів
    if (!out) {                   // Якщо не вдалося відкрити файл
        cerr << "Не вдалося відкрити файл для запису!" << endl;   // Повідомляємо про помилку
        return;                   // Вихід з функції
    }

    string line;                  // Змінна для зчитування рядків
    while (getline(file, line)) { // Поки є рядки для читання
        if (is_valid(line)) {     // Якщо рядок валідний
            int count = count_words(line); // Підрахунок кількості слів
            out << "Рядок: \"" << line << "\" має " << count << " слів." << endl; // Запис результату
        } else {
            out << "Рядок \"" << line << "\" недопустимий." << endl; // Запис повідомлення про недопустимість рядка
        }
    }

    file.close();                 // Закриваємо вхідний файл
    out.close();                  // Закриваємо файл з результатами
}
